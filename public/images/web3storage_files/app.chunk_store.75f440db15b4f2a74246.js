(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{10:function(e,t,n){"use strict";n.d(t,"b",(function(){return O}));n.d(t,"a",(function(){return p}));var o=n(0);var i=n.n(o);var r=n(235);var c=n(941);var a=n(463);var s=n(943);var u=n(448);var d=n(116);var l=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};const f=e=>Object.assign({},e);function v(e){return Object(d["a"])("noop",e,{shouldPersist:false})}function h(e){return(t,n)=>{if(n.type==="__initialize__"){return e(undefined,n)}return e(t,n)}}function y(e){return e.length===0}function p(e){const t=Object(r["createStore"])(f,{},Object(c["composeWithDevTools"])(Object(r["applyMiddleware"])(s["a"])));const n=Object(a["c"])(t,{manualPersist:true});const o=()=>l(this,void 0,void 0,(function*(){yield n.flush();yield Object(d["c"])(t)}));const p=y(e)?Promise.resolve(e()):Promise.resolve(e);const m=p.then((e=>{const o=Object(d["b"])(e)?e:v(e);const i=h(o);t.replaceReducer(i);t.dispatch({type:"__initialize__"});n.persist()})).then((()=>Object(d["d"])(n)));const _={useSelector(e,n){const o=Object(u["b"])((()=>e(t.getState())),n);return o},useDispatch(){return t.dispatch}};const O=i.a.lazy((()=>l(this,void 0,void 0,(function*(){yield m;const e=e=>i.a.createElement(u["a"],{store:e.store},e.children);return{default:e}}))));const b=e=>{const{children:n,loading:o=null}=e;return i.a.createElement(i.a.Suspense,{fallback:o},i.a.createElement(O,{store:t},n))};return Object.assign(t,{ready:m,syncPersistor:o,hooks:_,Provider:b})}var m=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function _(){return m(this,void 0,void 0,(function*(){const[{System:e},{Theme:t},{Auth:o},{UIThread:i}]=yield Promise.all([n.e(26).then(n.bind(null,2117)),n.e(26).then(n.bind(null,2118)),n.e(26).then(n.bind(null,2119)),n.e(26).then(n.bind(null,2120))]);return Object(r["combineReducers"])({System:e,Theme:t,Auth:o,UIThread:i})}))}const O=p(_)},116:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));n.d(t,"b",(function(){return f}));n.d(t,"c",(function(){return v}));n.d(t,"d",(function(){return h}));var o=n(463);var i=n(7);var r=n.n(i);var c=n(301);var a=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};const s={getItem:()=>a(void 0,void 0,void 0,(function*(){})),setItem:()=>a(void 0,void 0,void 0,(function*(){})),removeItem:()=>a(void 0,void 0,void 0,(function*(){}))};const u=new Map;const d=Symbol("If this symbol is present on a reducer function, that means we've already processed it with `redux-persist`!");function l(e,t,n={}){const{shouldPersist:r=true}=n;const a=Object(i["merge"])({},n,{storage:r?c["a"].data:s,key:e});const l=Object(o["b"])(a,t);l[d]=true;if(r){u.set(e,{whitelist:a.whitelist,blacklist:a.blacklist,storage:a.storage})}return l}function f(e){return!!e[d]}function v(e){return a(this,void 0,void 0,(function*(){const t=[...u.keys()];yield Promise.all(t.map((t=>a(this,void 0,void 0,(function*(){const{whitelist:n=[],blacklist:i=[],storage:r}=u.get(t);try{const c=yield r.getItem(`persist:${t}`);const a=JSON.parse(c!==null&&c!==void 0?c:"{}");const s=Object.keys(a).reduce(((e,t)=>{if(n&&!n.includes(t))return e;if(i&&i.includes(t))return e;try{e[t]=JSON.parse(a[t]);return e}catch(e){}return e}),{});e.dispatch({key:t,payload:s,type:o["a"]})}catch(e){}})))))}))}function h(e){return new Promise((t=>{const n=()=>{if(e.getState().bootstrapped){o();t(true)}};const o=e.subscribe(n);n()}))}},117:function(e,t,n){"use strict";n.d(t,"c",(function(){return s}));n.d(t,"b",(function(){return u}));n.d(t,"d",(function(){return d}));n.d(t,"a",(function(){return l}));var o=n(25);const i="uiThread/SET_UI_THREAD_PAYLOAD";const r="uiThread/SET_UI_THREAD_ERROR";const c="uiThread/SET_UI_THREAD_RENDER_FN";const a="uiThread/SET_RETURN_ROUTE_PAGE_ID";const s=Object(o["createAction"])(i,(e=>e))();const u=Object(o["createAction"])(r,(e=>e))();const d=Object(o["createAction"])(c,(e=>e))();const l=Object(o["createAction"])(a,(e=>e))()},118:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o=n(6);var i=n(173);var r=n(98);var c=n(32);var a=n(117);var s=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function u(e,t){return(n,c)=>s(this,void 0,void 0,(function*(){const s=c().UIThread.payload;if(e.method===(s===null||s===void 0?void 0:s.method)){yield o["q"].client.duplicatePayload(e.method).sdkReject(e);return false}yield i["c"].acquire();n(Object(r["c"])(true));n(Object(a["c"])(e));n(Object(a["b"])(undefined));n(Object(a["d"])(t));return true}))}function d(e){return(t,n)=>s(this,void 0,void 0,(function*(){const{payload:o}=n().UIThread;if(i["c"].getPermits()===0&&!!o){t(Object(a["c"])(undefined));yield t(c["a"].resolveJsonRpcResponse(Object.assign({payload:o},e)));t(Object(r["c"])(false));t(Object(a["d"])(undefined));i["c"].release()}}))}const l={releaseLockAndHideUI:d,acquireLockAndShowUI:u}},1194:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var o=n(253);var i=n(26);var r=n(21);var c=n(88);var a=n(148);var s=n(1222);var u=n(136);var d=n(384);var l=n(234);var f=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function v(){return e=>f(this,void 0,void 0,(function*(){var t,n;const s=Object(i["c"])(r["a"].Client.PreviewV1);e(Object(d["a"])(Object.assign(Object.assign({},Object(o["a"])(Object.assign(Object.assign({},c["a"].config),{primaryColor:Object(a["a"])(`#${s.color}`)?`#${s.color}`:c["a"].hex.primary.base,type:s.themeType}))),{logoImage:(t=s.logoImage)!==null&&t!==void 0?t:c["a"].logoImage,appName:(n=s.appName)!==null&&n!==void 0?n:c["a"].appName,isPreview:true})))}))}function h(){return e=>f(this,void 0,void 0,(function*(){var t,n,i,r;try{const a=yield s["a"].retrieve();e(Object(d["a"])(Object.assign(Object.assign({},Object(o["a"])(Object.assign(Object.assign({},c["a"].config),{primaryColor:(t=a.data.button_color)!==null&&t!==void 0?t:c["a"].hex.primary.base,type:(n=a.data.theme_color)!==null&&n!==void 0?n:undefined}))),{logoImage:(i=a.data.asset_uri)!==null&&i!==void 0?i:c["a"].logoImage,appName:(r=a.data.app_name)!==null&&r!==void 0?r:c["a"].appName,isPreview:false})))}catch(e){}}))}function y(e){return t=>f(this,void 0,void 0,(function*(){var n,i,r,a;t(Object(d["a"])(Object.assign(Object.assign({},Object(o["a"])(Object.assign(Object.assign({},c["a"].config),{primaryColor:(n=e===null||e===void 0?void 0:e.button_color)!==null&&n!==void 0?n:c["a"].hex.primary.base,type:(i=e===null||e===void 0?void 0:e.theme_color)!==null&&i!==void 0?i:undefined}))),{logoImage:(r=e===null||e===void 0?void 0:e.asset_uri)!==null&&r!==void 0?r:c["a"].logoImage,appName:(a=e===null||e===void 0?void 0:e.app_name)!==null&&a!==void 0?a:c["a"].appName,isPreview:false})))}))}function p(){return e=>f(this,void 0,void 0,(function*(){const t=Object(u["a"])();switch(t){case r["a"].Client.SendV1:return e(m.hydrateThemeFromApiResponse());case r["a"].Client.ConfirmV1:case r["a"].Client.ConfirmEmailV1:case r["a"].Client.LoginV1:{const{ct:t}=Object(i["c"])(r["a"].Client.ConfirmV1);if(t)return e(m.hydrateThemeFromRawConfig(t));break}case r["a"].Client.PreviewV1:return e(m.hydrateThemeFromPreviewQuery());default:{const t=Object(l["d"])();if(t)return e(m.hydrateThemeFromRawConfig(t));break}}}))}const m={hydrateThemeFromRawConfig:y,bootstrapTheme:p,hydrateThemeFromApiResponse:h,hydrateThemeFromPreviewQuery:v}},28:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));n.d(t,"j",(function(){return _}));n.d(t,"b",(function(){return O}));n.d(t,"i",(function(){return b}));n.d(t,"m",(function(){return j}));n.d(t,"l",(function(){return g}));n.d(t,"e",(function(){return A}));n.d(t,"d",(function(){return E}));n.d(t,"h",(function(){return w}));n.d(t,"g",(function(){return T}));n.d(t,"c",(function(){return I}));n.d(t,"k",(function(){return S}));n.d(t,"f",(function(){return C}));var o=n(25);const i="auth/INIT_AUTH_STATE";const r="auth/SET_USER_ID";const c="auth/SET_CLIENT_ID";const a="auth/SET_USER_EMAIL";const s="auth/SET_UST";const u="auth/SET_RT";const d="auth/SET_DELEGATED_WALLET_INFO";const l="auth/SET_USER_KEYS";const f="auth/SET_LOGIN_TYPE";const v="auth/SET_USER_PHONE_NUMBER";const h="auth/SET_USER_MFA_ACTIVE";const y="auth/SET_LOGIN_FLOW_CONTEXT";const p="auth/SET_LOGIN_FACTORS_REQUIRED";const m=Object(o["createAction"])(i)();const _=Object(o["createAction"])(r,(e=>e))();const O=Object(o["createAction"])(c,(e=>e))();const b=Object(o["createAction"])(a,(e=>e))();const j=Object(o["createAction"])(v,(e=>e))();const g=Object(o["createAction"])(h,(e=>e))();const A=Object(o["createAction"])(y,(e=>e))();const E=Object(o["createAction"])(p,(e=>e))();const w=Object(o["createAction"])(s,(e=>e))();const T=Object(o["createAction"])(u,(e=>e))();const I=Object(o["createAction"])(d,(e=>e))();const S=Object(o["createAction"])(l,(e=>e))();const C=Object(o["createAction"])(f,(e=>e))()},32:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var o=n(257);var i=n(7);var r=n(220);var c=n(6);var a=n(112);var s=n(14);const u=e=>e.Auth||{};const d=e=>u(e).rt;var l=n(69);var f=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function v(e){return(t,n)=>f(this,void 0,void 0,(function*(){var t,u,f;const v=Object(c["m"])(e.error)?e.error.jsonRpcError:(t=e.error)!==null&&t!==void 0?t:undefined;const h=!Object(i["isUndefined"])(v);const y=!Object(i["isUndefined"])(e.result)&&!h;const p={jsonrpc:(u=e.payload.jsonrpc)!==null&&u!==void 0?u:"2.0",id:(f=e.payload.id)!==null&&f!==void 0?f:null,result:y?e.result:undefined,error:h?v:undefined};Object(l["c"])(e.payload,n,y);const m=d(n());a["a"].rpc.post(r["FmIncomingWindowMessage"].FORTMATIC_HANDLE_RESPONSE,p,m);a["a"].rpc.post(o["c"].MAGIC_HANDLE_RESPONSE,p,m);Object(s["e"])(e.payload).emit("done")}))}function h(e){return()=>f(this,void 0,void 0,(function*(){var t,n;const{payload:i,event:r,params:c=[]}=e;const s={jsonrpc:(t=i.jsonrpc)!==null&&t!==void 0?t:"2.0",id:(n=i.id)!==null&&n!==void 0?n:null,result:{event:r,params:c}};a["a"].rpc.post(o["c"].MAGIC_HANDLE_EVENT,s)}))}const y={emitJsonRpcEvent:h,resolveJsonRpcResponse:v}},384:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(25);const i="theme/SET_THEME";const r=Object(o["createAction"])(i,(e=>e))()},45:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var o=n(99);var i=n.n(o);var r=n(41);var c=n(119);var a=n(386);var s=n(577);var u=n(50);var d=n(75);var l=n(24);var f=n(172);var v=n(328);var h=n(48);var y=n(118);var p=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function m(e){return(t,n)=>p(this,void 0,void 0,(function*(){const t=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:o}=n().Auth;const{systemClockOffset:i}=n().System;let a=yield c["a"].kmsDecrypt(t,o,i);const s=r["a"].signTypedDataV1(e,a);a=null;return s}))}function _(e){return(t,n)=>p(this,void 0,void 0,(function*(){const t=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:o}=n().Auth;const{systemClockOffset:i}=n().System;let a=yield c["a"].kmsDecrypt(t,o,i);const s=r["a"].signTypedDataV3(e,a);a=null;return s}))}function O(e){return(t,n)=>p(this,void 0,void 0,(function*(){const t=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:o}=n().Auth;const{systemClockOffset:i}=n().System;let a=yield c["a"].kmsDecrypt(t,o,i);const s=r["a"].signTypedDataV4(e,a);a=null;return s}))}function b(e){return(t,n)=>p(this,void 0,void 0,(function*(){const t=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:o}=n().Auth;const{systemClockOffset:i}=n().System;let a=yield c["a"].kmsDecrypt(t,o,i);const s=r["a"].personalSign(e,a);a=null;return s}))}function j(e){return(t,n)=>p(this,void 0,void 0,(function*(){const t=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:o}=n().Auth;const{systemClockOffset:i}=n().System;let a=yield c["a"].kmsDecrypt(t,o,i);return r["a"].signTransaction(e,a).finally((()=>{a=null}))}))}function g(e){return(t,n)=>p(this,void 0,void 0,(function*(){var i,c,s,u,d,l,f,v,h,y,p;const{Auth:m}=n();const _=yield r["a"].getChainId();const O={to:e.params[0].to,value:e.params[0].value,data:e.params[0].data,chainId:Object(o["hexToNumber"])(_)||1};const b=(yield a["a"].getTransactionFeeV2(e,(i=m.userKeys)===null||i===void 0?void 0:i.walletId)).data;const j=b.estimated_gas_limit;const g=(c=b.priority)===null||c===void 0?void 0:c.crypto_gas_price_in_hex;const A=(s=e.params[0])===null||s===void 0?void 0:s.data;const E=A&&A!=="0x"&&A!=="0x0"?91e3:21e3;const{maxPriorityFeePerGas:w,maxFeePerGas:T}=e.params[0];if(w){O.maxPriorityFeePerGas=w;O.maxFeePerGas=T}else{O.gasPrice=(l=(d=(u=e.params[0].gasPrice)!==null&&u!==void 0?u:g)!==null&&d!==void 0?d:yield r["a"].getGasPrice())!==null&&l!==void 0?l:undefined}O.gas=(h=(v=(f=e.params[0].gas)!==null&&f!==void 0?f:j)!==null&&v!==void 0?v:yield r["a"].estimateGas(O))!==null&&h!==void 0?h:E;O.nonce=(p=(y=e.params[0].nonce)!==null&&y!==void 0?y:yield r["a"].getTransactionCount(m.userKeys.publicAddress))!==null&&p!==void 0?p:undefined;const{rawTransaction:S}=yield t(I.signTransactionForUser(O));return r["a"].sendRawTransaction(S)}))}function A(e,t){return(n,o)=>p(this,void 0,void 0,(function*(){let i=null;let r=null;let a;try{const{Auth:n}=o();const{userID:f,userKeys:v,clientID:h,delegatedWalletInfo:y}=n;const{systemClockOffset:p}=o().System;if(f&&v.publicAddress&&v.encryptedPrivateAddress&&h){if(Object(u["i"])()){i=yield c["a"].kmsDecrypt(v.encryptedPrivateAddress,y,p);r={privateKey:i,address:v.publicAddress};a=h}else{const e=(yield d["a"].getUserInfo(f,l["e"].ETH)).data;i=yield c["a"].kmsDecrypt(e.encrypted_private_address,y,p);r={privateKey:i,address:e.public_address};a=e.client_id}return s["a"].createToken({account:r,subject:f,audience:a,lifespan:e,attachment:t,systemClockOffset:o().System.systemClockOffset})}return null}catch(e){yield n(h["a"].logout());return null}finally{r=null;i=null}}))}function E(e){var t;if(e===void 0){e=((t=Object(f["a"])()._oaclientmeta)===null||t===void 0?void 0:t.encrypted_access_token)||""}return(t,n)=>p(this,void 0,void 0,(function*(){const n=15*60;if(e){return t(I.createDIDTokenForUser(n,e))}return null}))}function w(e){return(t,n)=>p(this,void 0,void 0,(function*(){var o;try{const{userID:i}=n().Auth;const{delegatedWalletInfo:r}=n().Auth;const{systemClockOffset:a}=n().System;yield d["a"].exportWallet(i);const s=n().Auth.userKeys.encryptedPrivateAddress;e.params[0]=(o=yield c["a"].kmsDecrypt(s,r,a))===null||o===void 0?void 0:o.substring(2);yield t(y["a"].acquireLockAndShowUI(e));return"success"}catch(e){yield t(h["a"].logout());return"failed"}}))}function T(e){return(t,n)=>p(this,void 0,void 0,(function*(){try{const{userID:o}=n().Auth;yield d["a"].exportWallet(o);const i=(yield d["a"].getUserInfo(o,e.params[0].walletType)).data;const{delegatedWalletInfo:r}=n().Auth;const{systemClockOffset:a}=n().System;const s=i.encrypted_private_address;const f=yield c["a"].kmsDecrypt(s,r,a);e.params[0]=f;if(Object(u["g"])()===l["e"].SOLANA){const t=yield Object(v["b"])();e.params[0]=yield t.convertMnemonicToRawPrivateKey(e,f)}yield t(y["a"].acquireLockAndShowUI(e));return"success"}catch(e){yield t(h["a"].logout());return"failed"}}))}const I={personalSignForUser:b,signTypedDataV4ForUser:O,signTypedDataV3ForUser:_,signTypedDataV1ForUser:m,sendTransactionForUser:g,signTransactionForUser:j,createDIDTokenForUser:A,createOAuthMagicCredentialForUser:E,exportPrivateKeyForUser:w,exportPrivateKeyForUserInLedger:T}},48:function(e,t,n){"use strict";n.d(t,"a",(function(){return H}));var o=n(220);var i=n.n(o);var r=n(7);var c=n.n(r);var a=n(6);var s=n(75);var u=n(41);var d=n(119);var l=n(222);var f=n(112);var v=n(50);var h=n(24);var y=n(328);var p=n(760);var m=n(27);var _=n(549);var O=n(14);var b=n(1223);var j=n(174);var g=n(233);var A=n(26);var E=n(21);var w=n(45);var T=n(32);var I=n(98);var S=n(28);var C=undefined&&undefined.__awaiter||function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function c(e){try{s(o.next(e))}catch(e){r(e)}}function a(e){try{s(o["throw"](e))}catch(e){r(e)}}function s(e){e.done?n(e.value):i(e.value).then(c,a)}s((o=o.apply(e,t||[])).next())}))};function k(e,t,n){return(o,i)=>C(this,void 0,void 0,(function*(){try{o(Object(S["a"])());o(Object(S["i"])(e));const i=Object(g["c"])(128);const{jwt:r}=Object(O["d"])(n);yield o(H.sendMagicLink(i,t,n,r));yield o(H.waitForMagicLinkClicked(i,e,r));yield o(H.persistSessionCookies(i));yield o(H.populateUserCredentials())}catch(e){l["a"].clear("eth_accounts","eth_coinbase");if(Object(a["m"])(e)||Object(a["l"])(e))throw e;if(Object(a["n"])(e))throw e.getControlFlowError();throw a["q"].client.userDeniedAccountAccess()}}))}function R(e,t){return(n,o)=>C(this,void 0,void 0,(function*(){try{n(Object(S["a"])());const{auth_user_id:o,auth_user_session_token:i,refresh_token:r,email:c,rom:a}=(yield s["a"].redirectLogin(e,t)).data;n(Object(S["i"])(c));n(Object(S["j"])(o));n(Object(S["h"])(i));n(Object(S["g"])(r));yield n(H.persistSessionCookies(a));yield n(H.populateUserCredentials())}catch(e){l["a"].clear("eth_accounts","eth_coinbase");if(Object(a["m"])(e)||Object(a["l"])(e))throw e;if(Object(a["n"])(e))throw e.getControlFlowError();throw a["q"].client.userDeniedAccountAccess()}}))}function P(e={}){return(t,n)=>C(this,void 0,void 0,(function*(){const{from:o,rt:i,jwt:c}=e;const a=o==="storage"||Object(r["isUndefined"])(o);const u=o==="cookies"||Object(r["isUndefined"])(o);const{userID:d,ust:f}=n().Auth;if(a&&d&&f){try{yield t(H.populateUserCredentials());return true}catch(e){console.warn("could not authenticate via storage",e)}}if(u&&m["m"]&&!m["p"]){try{const{auth_user_id:e,auth_user_session_token:n,email:o,phone_number:i}=(yield p["a"].refresh()).data;t(Object(S["j"])(e));t(Object(S["h"])(n));t(Object(S["i"])(o));t(Object(S["m"])(i));yield t(H.populateUserCredentials());return true}catch(e){console.warn("could not authenticate via cookie",e)}}if(i&&c){try{const{auth_user_id:e,auth_user_session_token:n,refresh_token:o,email:r,phone_number:a}=(yield s["a"].getUstWithRt(i,c)).data;t(Object(S["j"])(e));t(Object(S["h"])(n));t(Object(S["g"])(o));t(Object(S["i"])(r));t(Object(S["m"])(a));yield t(H.populateUserCredentials());return true}catch(e){console.warn("could not authenticate via refresh token",e)}}yield t(H.logout({shouldCallLogoutApi:false}));l["a"].clear("eth_accounts","eth_coinbase");return false}))}function U({shouldCallLogoutApi:e}={shouldCallLogoutApi:true}){return(t,n)=>C(this,void 0,void 0,(function*(){l["a"].clear("eth_accounts","eth_coinbase");if(e){yield s["a"].logout(n().Auth.userID).catch(r["noop"])}t(Object(S["a"])());f["a"].rpc.post(o["FmIncomingWindowMessage"].FORTMATIC_USER_LOGOUT)}))}function D(e,t,n,o){return(i,r)=>C(this,void 0,void 0,(function*(){var c;try{const{userEmail:a}=r().Auth;const u=(c=Object(A["c"])(E["a"].Client.SendV1).ext)===null||c===void 0?void 0:c.uservoiceThemeProvider;const d=yield s["a"].loginStart(a,e,t,o,u);i(Object(I["d"])(d.data.utc_timestamp_ms));i(Object(S["e"])(d.data.login_flow_context));i(T["a"].emitJsonRpcEvent({payload:n,event:"email-sent"}))}catch(e){i(T["a"].emitJsonRpcEvent({payload:n,event:"email-not-deliverable"}));if(Object(a["n"])(e))throw e.getControlFlowError();else throw Object(a["f"])(e).getControlFlowError()}}))}function F(e,t,n){return(o,i)=>{var r;const c=(r=i().UIThread.payload)===null||r===void 0?void 0:r.id;return Object(_["a"])({delay:5e3,interval:2e3,expiresIn:1e3*60*20,onInterval:(r,u)=>C(this,void 0,void 0,(function*(){var d;try{if(c&&((d=i().UIThread.payload)===null||d===void 0?void 0:d.id)!==c)return u();const a=t!==null&&t!==void 0?t:i().Auth.userEmail;const{loginFlowContext:l}=i().Auth;const f=yield s["a"].loginStatus({email:a,requestOriginMessage:e,jwt:n,loginFlowContext:l});const{auth_user_id:v,auth_user_session_token:h,refresh_token:y}=f.data;o(Object(S["j"])(v));o(Object(S["h"])(h));o(Object(S["g"])(y));r()}catch(e){if([a["a"].LoginWithMagicLinkExpired,a["a"].OverMAUQuota,a["a"].AnomalousRequestDetected,a["a"].UnsupportedEthereumNetwork].includes(Object(a["o"])(e))){u(e)}}})),onExpire:(e,t)=>C(this,void 0,void 0,(function*(){t(Object(a["c"])(a["a"].LoginWithMagicLinkExpired))}))})}}function L(e,t,n,o,i=0){return C(this,void 0,void 0,(function*(){if(!!o&&!!t&&(o===null||o===void 0?void 0:o.should_create_delegated_wallet)){const{delegated_key_id:r}=o;try{let e;let r="";switch(n){case h["e"].ETH:{e=u["a"].createWallet();break}case h["e"].FLOW:{const n=Object(v["e"])()==="mainnet"?j["a"].mainnet:j["a"].testnet;e=yield(yield Object(y["a"])()).ledgerBridge.createWallet((e=>b["a"].flowSignMessage(t,e)),n);break}default:e=yield(yield Object(y["a"])()).ledgerBridge.createWallet()}const c=yield d["a"].kmsEncrypt(e.privateKey,o,i);if(e.mnemonic)r=yield d["a"].kmsEncrypt(e.mnemonic,o,i);e.mnemonic=null;e.privateKey=null;if(c)yield s["a"].syncWallet(t,e.address,c,n,r,e.HDWalletPath);else throw new Error("Private key encryption result is falsey.")}catch(t){e(H.logout())}}}))}function M(){return(e,t)=>C(this,void 0,void 0,(function*(){var n;const o=n=>C(this,void 0,void 0,(function*(){const o=(yield s["a"].getUserInfo(t().Auth.userID,n)).data;e(Object(S["c"])(o.delegated_wallet_info));e(Object(S["k"])({publicAddress:o.public_address,encryptedPrivateAddress:o.encrypted_private_address,walletId:o.auth_user_wallet_id}));e(Object(I["d"])(o.utc_timestamp_ms));e(Object(S["f"])(o.login.type));e(Object(S["b"])(o.client_id));e(Object(S["l"])(o.auth_user_mfa_active))}));const i=n=>C(this,void 0,void 0,(function*(){yield o(n);const{Auth:i}=t();const{systemClockOffset:r}=t().System;yield H.syncWallet(e,i.userID,n,i.delegatedWalletInfo,r)}));if(!Object(v["i"])())yield i(h["e"].ETH);yield i(Object(v["g"])());if((n=t().Auth.delegatedWalletInfo)===null||n===void 0?void 0:n.should_create_delegated_wallet){yield o(Object(v["g"])())}}))}function N(e){return(t,n)=>C(this,void 0,void 0,(function*(){if(m["m"]&&!m["p"]){const{userID:t}=n().Auth;yield p["a"].persist(t,e).catch((()=>{}))}}))}function x(e,t,n,o){return(i,r)=>C(this,void 0,void 0,(function*(){try{i(Object(S["j"])(e));i(Object(S["h"])(t));yield i(H.populateUserCredentials());const r=yield i(w["a"].createDIDTokenForUser(o));yield Object(O["i"])(n,r)}catch(e){yield a["q"].client.webAuthnRegistrationFailed().sdkReject(n)}}))}function W(e,t,n="testnet"){return(o,i)=>C(this,void 0,void 0,(function*(){o(Object(S["a"])());const i=yield s["a"].redirectConfirm(e,t,n);o(Object(S["j"])(i.data.auth_user_id));o(Object(S["i"])(i.data.email));o(Object(S["h"])(i.data.ephemeral_auth_user_session_token));yield o(H.populateUserCredentials())}))}const H={sendMagicLink:D,loginWithMagicLink:k,loginWithCredential:R,hydrateActiveUser:P,populateUserCredentials:M,waitForMagicLinkClicked:F,syncWallet:L,logout:U,persistSessionCookies:N,processWebAuthnLoginSession:x,hydrateUserSessionFromRedirectConfirm:W}},98:function(e,t,n){"use strict";n.d(t,"f",(function(){return m}));n.d(t,"h",(function(){return _}));n.d(t,"g",(function(){return O}));n.d(t,"i",(function(){return b}));n.d(t,"b",(function(){return j}));n.d(t,"e",(function(){return g}));n.d(t,"a",(function(){return A}));n.d(t,"c",(function(){return E}));n.d(t,"d",(function(){return w}));var o=n(220);var i=n(25);var r=n(257);const c="system/START_JSON_RPC_MESSAGE_CHANNEL";const a="system/STOP_JSON_RPC_MESSAGE_CHANNEL";const s="system/START_THEME_PREVIEW_MESSAGE_CHANNEL";const u="system/STOP_THEME_PREVIEW_MESSAGE_CHANNEL";const d="system/FORTMATIC_OVERLAY_GREENLIGHT";const l="system/FORTMATIC_SHOW_OVERLAY";const f="system/FORTMATIC_HIDE_OVERLAY";const v="system/PUSH_PAYLOAD_HISTORY";const h="system/SET_SHOW_UI";const y="system/SET_SYSTEM_CLOCK_OFFSET";var p=n(112);const m=Object(i["createAction"])(c,(()=>{window.addEventListener("message",p["a"].rpc.handle)}))();const _=Object(i["createAction"])(a,(()=>{window.removeEventListener("message",p["a"].rpc.handle)}))();const O=Object(i["createAction"])(s,(()=>{window.addEventListener("message",p["a"].themePreview.handle);p["a"].themePreview.postReady()}))();const b=Object(i["createAction"])(u,(()=>{window.removeEventListener("message",p["a"].themePreview.handle)}))();const j=Object(i["createAction"])(d,(()=>{p["a"].rpc.post(o["FmIncomingWindowMessage"].FORTMATIC_OVERLAY_READY);p["a"].rpc.post(r["c"].MAGIC_OVERLAY_READY)}))();const g=Object(i["createAction"])(l,(()=>{p["a"].rpc.post(o["FmIncomingWindowMessage"].FORTMATIC_SHOW_OVERLAY);p["a"].rpc.post(r["c"].MAGIC_SHOW_OVERLAY)}))();const A=Object(i["createAction"])(f,(()=>{p["a"].rpc.post(o["FmIncomingWindowMessage"].FORTMATIC_HIDE_OVERLAY);p["a"].rpc.post(r["c"].MAGIC_HIDE_OVERLAY)}))();const E=Object(i["createAction"])(h,(e=>e))();const w=Object(i["createAction"])(y,(e=>e-Date.now()))()}}]);