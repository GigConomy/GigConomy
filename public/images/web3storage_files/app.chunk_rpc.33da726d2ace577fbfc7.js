(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{14:function(e,t,n){"use strict";n.d(t,"f",(function(){return b}));n.d(t,"g",(function(){return m}));n.d(t,"i",(function(){return g}));n.d(t,"h",(function(){return j}));n.d(t,"a",(function(){return w}));n.d(t,"c",(function(){return _}));n.d(t,"b",(function(){return O}));n.d(t,"e",(function(){return A}));n.d(t,"d",(function(){return k}));var i=n(7);var o=n.n(i);var a=n(945);var s=n.n(a);var r=n(10);var c=n(6);var d=n(156);var u=n(216);var l=n(537);var v=n(173);var p=n(32);var f=n(48);var y=n(118);var h=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};function b(...e){return h(this,void 0,void 0,(function*(){return r["b"].dispatch(f["a"].hydrateActiveUser(...e))}))}function m(...e){return h(this,void 0,void 0,(function*(){const t=yield r["b"].dispatch(f["a"].hydrateActiveUser(...e));if(!t)throw c["q"].client.userDeniedAccountAccess()}))}function g(e,t){var n;return h(this,void 0,void 0,(function*(){const i=r["b"].getState();if(i.System.showUI&&e.id===((n=i.UIThread.payload)===null||n===void 0?void 0:n.id)){yield r["b"].dispatch(y["a"].releaseLockAndHideUI({result:t}))}else{yield r["b"].dispatch(p["a"].resolveJsonRpcResponse({payload:e,result:t}))}}))}function j(e,t){var n;return h(this,void 0,void 0,(function*(){const i=r["b"].getState();if(i.System.showUI&&e.id===((n=i.UIThread.payload)===null||n===void 0?void 0:n.id)){yield r["b"].dispatch(y["a"].releaseLockAndHideUI({error:t}))}else{yield r["b"].dispatch(p["a"].resolveJsonRpcResponse({payload:e,error:t}))}}))}function w(e){return h(this,void 0,void 0,(function*(){if(e.method.startsWith("testMode/eth/")){e.method=e.method.replace("testMode/eth/","")}yield v["b"].acquire();A(e).once("done",(()=>{v["b"].signal()}));const t=yield d["a"].ethereumProxy(e);yield r["b"].dispatch(p["a"].resolveJsonRpcResponse({payload:e,result:t}))}))}function _(e,t){const n=Object(u["b"])(t).map((t=>t.routes[e.method])).find((e=>!Object(i["isNil"])(e)));return n===null||n===void 0?void 0:n.handler.bind(n)}function O(e,t={},n){return(o,a)=>{const s=Object.assign({payload:o,getState:r["b"].getState,dispatch:r["b"].dispatch,render:n},a);const c=Object(i["fromPairs"])(Object.entries(t).map((([e,t])=>[e,t.bind(t,o,s)])));const d=A(o);for(const[e,t]of Object.entries(c)){d.on(e,t)}return Object(l["a"])(e.map((e=>()=>new Promise(((t,n)=>{const i=()=>t();Promise.resolve(e.apply(e,[s,i])).catch(n)})))))}}const R=Symbol("eventsSymbol");function A(e){if(!e[R])e[R]=new s.a;return e[R]}const S=Symbol("payloadDataSymbol");function k(e){if(!e[S])e[S]={};return e[S]}},149:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n.d(t,"b",(function(){return d}));var i=n(153);var o=n(6);var a=n(300);var s=n(14);const r=new Set(["eth_gasPrice","net_version","eth_coinbase"]);const c=({payload:e},t)=>{if(Object(i["b"])()&&!r.has(e.method)){e.method=`mc_${e.method}`;Object(a["b"])(e)}else{t()}};const d=({payload:e},t)=>{if(Object(i["b"])()){Object(s["h"])(e,o["q"].web3.unsupportedConnectMethod())}else{t()}};const u=({payload:e},t)=>{if(Object(i["b"])()&&e.method==="magic_auth_settings"){e.method=`mc_wallet`;Object(a["b"])(e)}else{t()}}},202:function(e,t,n){"use strict";n.d(t,"c",(function(){return y}));n.d(t,"a",(function(){return h}));n.d(t,"b",(function(){return b}));n.d(t,"d",(function(){return m}));var i=n(7);var o=n.n(i);var a=n(14);var s=n(148);var r=n(6);var c=n(46);var d=n(24);var u=n(32);var l=n(45);var v=n(48);var p=n(117);var f=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const y=(e,t)=>f(void 0,void 0,void 0,(function*(){const{payload:n,getState:o}=e;const[{email:s,redirectURI:r}]=n.params;e.emailNormalized=Object(i["trim"])(s);e.redirectURI=r;const{jwt:c,rt:d}=Object(a["d"])(n);const u=yield Object(a["f"])({rt:d,jwt:c});const{Auth:l}=o();e.isLoggedIn=u&&!!l.ust;t()}));const h=(e,t)=>f(void 0,void 0,void 0,(function*(){const{payload:n,getState:i,dispatch:o,emailNormalized:s,isLoggedIn:r}=e;const{Auth:c}=i();if(r){if((s===null||s===void 0?void 0:s.toLowerCase())===c.userEmail.toLowerCase()&&c.loginType===d["a"].EmailLink){try{const t=yield o(l["a"].createDIDTokenForUser(e.defaultTokenLifespan));return Object(a["i"])(n,t)}catch(e){}}yield o(v["a"].logout({shouldCallLogoutApi:false}))}t()}));const b=e=>f(void 0,void 0,void 0,(function*(){const{payload:t,getState:n,dispatch:i,emailNormalized:o,redirectURI:d}=e;if(!Object(s["b"])(o))throw Object(r["c"])(r["a"].MalformedEmail);yield i(v["a"].loginWithMagicLink(o,d,t));Object(c["b"])({email:n().Auth.userEmail,userID:n().Auth.userID});const u=yield i(l["a"].createDIDTokenForUser(e.defaultTokenLifespan));yield Object(a["i"])(t,u)}));const m=e=>f(void 0,void 0,void 0,(function*(){const{payload:t,getState:n,dispatch:i,emailNormalized:o,redirectURI:s}=e;i(u["a"].emitJsonRpcEvent({payload:t,event:"retry"}));i(Object(p["b"])(undefined));yield i(v["a"].loginWithMagicLink(o,s,t));Object(c["b"])({email:n().Auth.userEmail,userID:n().Auth.userID});const r=yield i(l["a"].createDIDTokenForUser(e.defaultTokenLifespan));yield Object(a["i"])(t,r)}))},217:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n.d(t,"b",(function(){return l}));var i=n(7);var o=n.n(i);var a=n(216);var s=n(14);var r=n(173);var c=n(10);var d=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};class u{constructor(...e){this.uiEvents={};this.middlewares=e;this.initialContextFactory=()=>({})}uiEvent(e,...t){this.uiEvents[e]=Object(s["b"])(t);return this}render(e){this._render=e;return this}provideInitialContext(e){this.initialContextFactory=e;return this}handler(e){return d(this,void 0,void 0,(function*(){const t=Object(s["d"])(e);if(!t.didAcquireConcurrencySemaphorePermit){yield r["b"].acquire();yield c["b"].syncPersistor();Object(s["e"])(e).once("done",(()=>{r["b"].signal()}));t.didAcquireConcurrencySemaphorePermit=true}const n=Object(s["b"])(this.middlewares,this.uiEvents,this._render);yield n(e,this.initialContextFactory())}))}loadConfig(e={}){var t,n,i;this._render=(t=e.render)!==null&&t!==void 0?t:this._render;this.middlewares=(n=e.middlewares)!==null&&n!==void 0?n:this.middlewares;this.initialContextFactory=(i=e.initialContextFactory)!==null&&i!==void 0?i:this.initialContextFactory;Object.keys(e.uiEvents||{}).forEach((t=>{var n;this.uiEvent(t,(n=e.uiEvents)===null||n===void 0?void 0:n[t])}));return this}}class l{constructor(e={}){this.globalMiddlewares=[];this.routes=Object.assign({},e)}use(e,...t){if(Object(i["isFunction"])(e)){this.globalMiddlewares.push(e,...t)}else{const n=new u(...this.globalMiddlewares,...t);Object(a["b"])(e).forEach((e=>{this.routes[e]=n}));return n}}}},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));n.d(t,"b",(function(){return I}));var i=n(7);var o=n(6);var a=n(586);var s=n(217);var r=n(267);var c=n(75);var d=n(24);var u=n(105);var l=n(32);var v=n(48);var p=n(45);var f=n(202);var y=n(37);var h=n(44);var b=n(171);var m=n.n(b);var g=n(14);var j=n(46);var w=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const _=(e,t)=>w(void 0,void 0,void 0,(function*(){var n;const{payload:i}=e;const[o]=i.params;try{const t=m.a.parse(o.substr(1)).magic_credential;e.credential=(n=t!==null&&t!==void 0?t:o)!==null&&n!==void 0?n:""}catch(t){e.credential=o!==null&&o!==void 0?o:""}t()}));const O=e=>w(void 0,void 0,void 0,(function*(){const{payload:t,getState:n,dispatch:i,credential:o}=e;const{jwt:a}=Object(g["d"])(t);yield i(v["a"].loginWithCredential(o,a));Object(j["b"])({email:n().Auth.userEmail,userID:n().Auth.userID});const s=yield i(p["a"].createDIDTokenForUser(e.defaultTokenLifespan));yield Object(g["i"])(t,s)}));var R=n(50);var A=n(38);var S=n(149);var k=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const D=60*15;const I=new s["b"];I.use(S["b"]);I.use(u["f"],Object(h["a"])(y["b"]),f["c"],f["a"],y["a"],f["b"]).uiEvent("retry",f["d"]).provideInitialContext((()=>({defaultTokenLifespan:D})));I.use(u["n"],A["a"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){if(Object(R["i"])()){const n=yield t(p["a"].exportPrivateKeyForUser(e));if(n==="failed")throw yield o["q"].client.userDeniedAccountAccess()}else if(Object(R["j"])(e.params[0].walletType)){const n=yield t(p["a"].exportPrivateKeyForUserInLedger(e));if(n==="failed")throw yield o["q"].client.userDeniedAccountAccess()}else{throw yield o["q"].magic.walletTypeNotSupport()}}))));I.use(u["e"],_,O).provideInitialContext((()=>({defaultTokenLifespan:D})));I.use([u["b"],u["c"]],A["a"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){let n=D;if(!Object(i["isEmpty"])(e.params[0])){const[{lifespan:t}]=e.params;if(t)n=t}const o=yield t(p["a"].createDIDTokenForUser(n));yield t(l["a"].resolveJsonRpcResponse({payload:e,result:o}))}))));I.use(u["a"],A["a"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){let n;let o=D;if(!Object(i["isEmpty"])(e.params[0])){const[{attachment:t,lifespan:i}]=e.params;if(t)n=t;if(i)o=i}const a=yield t(p["a"].createDIDTokenForUser(o,n));yield t(l["a"].resolveJsonRpcResponse({payload:e,result:a}))}))));I.use(u["d"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{jwt:i,rt:o}=Object(g["d"])(e);const a=yield Object(g["f"])({jwt:i,rt:o});const s=a&&!!n().Auth.ust;yield t(l["a"].resolveJsonRpcResponse({payload:e,result:s}))}))));I.use(u["i"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){try{if(n().Auth.userID)yield t(v["a"].logout());yield t(l["a"].resolveJsonRpcResponse({payload:e,result:true}))}catch(t){yield o["q"].rpc.internalError().sdkReject(e)}}))));I.use(u["m"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){const n=e.params[0];const{data:i}=yield r["a"].registrationStart(n.username);const o=Object(a["a"])(i.credential_options);yield t(l["a"].resolveJsonRpcResponse({payload:e,result:{id:i.webauthn_user_id,credential_options:o}}))}))));I.use(u["l"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){const n=e.params[0];const a={attObj:n.registration_response.attObj,clientData:n.registration_response.clientData};const s=Object(i["isEmpty"])(n.transport)?"unknown":n.transport[0];try{const{data:i}=yield r["a"].register(n.id,n.nickname,s,n.user_agent,a);t(v["a"].processWebAuthnLoginSession(i.auth_user_id,i.auth_user_session_token,e,D))}catch(t){yield o["q"].client.webAuthnRegistrationFailed().sdkReject(e)}}))));I.use(u["g"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){const{username:n}=e.params[0];const{data:i}=yield r["a"].webAuthnReAuthStart(n);const o=i.assertion_options;yield t(l["a"].resolveJsonRpcResponse({payload:e,result:Object(a["b"])(o)}))}))));I.use(u["h"],(({payload:e,dispatch:t})=>k(void 0,void 0,void 0,(function*(){const{username:n,assertion_response:i}=e.params[0];try{const{data:o}=yield r["a"].reauthVerify(n,i);t(v["a"].processWebAuthnLoginSession(o.auth_user_id,o.auth_user_session_token,e,D))}catch(t){yield o["q"].client.webAuthnRegistrationFailed().sdkReject(e)}}))));I.use(u["k"],A["a"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{userID:i}=n().Auth;const{data:o}=yield r["a"].registerDeviceStart(i);const s=Object(a["a"])(o.credential_options);yield t(l["a"].resolveJsonRpcResponse({payload:e,result:{credential_options:s}}))}))));I.use(u["j"],A["a"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{userID:o}=n().Auth;const a=e.params[0];const s={attObj:a.registration_response.attObj,clientData:a.registration_response.clientData};const c=Object(i["isEmpty"])(a.transport)?"unknown":a.transport[0];yield r["a"].registerDevice(o,a.nickname,c,a.user_agent,s);yield t(l["a"].resolveJsonRpcResponse({payload:e,result:true}))}))));I.use(u["o"],A["a"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{userID:i}=n().Auth;const{login:a}=(yield c["a"].getUserInfo(i)).data;let s={};if(a.type===d["a"].WebAuthn){s={devicesInfo:a.webauthn.devices_info,username:a.webauthn.username};yield t(l["a"].resolveJsonRpcResponse({payload:e,result:s}))}else{throw yield o["q"].client.webAuthnLoggedInError()}}))));I.use(u["p"],A["a"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{userID:i}=n().Auth;const{webAuthnCredentialsId:a}=e.params[0];try{yield r["a"].unregister(i,a);yield t(l["a"].resolveJsonRpcResponse({payload:e,result:true}))}catch(t){yield o["q"].client.webAuthnUnableFindDevice().sdkReject(e)}}))));I.use(u["q"],A["a"],(({payload:e,dispatch:t,getState:n})=>k(void 0,void 0,void 0,(function*(){const{userID:i}=n().Auth;const{webAuthnCredentialsId:a,nickname:s}=e.params[0];try{yield r["a"].update(i,a,s);yield t(l["a"].resolveJsonRpcResponse({payload:e,result:true}))}catch(t){yield o["q"].client.webAuthnUnableFindDevice().sdkReject(e)}}))))},300:function(e,t,n){"use strict";n.d(t,"b",(function(){return M}));n.d(t,"a",(function(){return N}));var i=n(7);var o=n(14);var a=n(6);var s=n(465);var r=n(148);var c=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};function d(e){return c(this,void 0,void 0,(function*(){if(!Object(r["c"])(e)){yield a["q"].rpc.parseError().sdkReject(e);return false}if(!Object(i["isPlainObject"])(e)){yield a["q"].client.malformedPayload().sdkReject(e);return false}if(Object(i["isNil"])(e===null||e===void 0?void 0:e.id)){yield a["q"].client.missingPayloadId().sdkReject(e);return false}if(Object(i["isUndefined"])(e===null||e===void 0?void 0:e.jsonrpc)){yield a["q"].client.missingRpcVersion().sdkReject(e);return false}if(Object(s["a"])(e)&&Object(i["isEmpty"])(e===null||e===void 0?void 0:e.batch)){yield a["q"].client.missingPayloadBatch().sdkReject(e);return false}return true}))}var u=n(50);var l=n(234);var v=n(217);var p=n(219);var f=n(216);var y=n(218);var h=n(32);var b=n(48);var m=n(45);var g=n(202);var j=n(37);var w=n(44);var _=n(38);var O=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const R=15*60;const A=new v["b"];A.use("fm_auth_login_with_magic_link",Object(w["a"])(j["b"]),g["c"],g["a"],j["a"],g["b"]).uiEvent("retry",g["d"]);A.use("fm_auth_get_access_token",_["a"],(({payload:e,dispatch:t})=>O(void 0,void 0,void 0,(function*(){let n=R;if(!Object(i["isEmpty"])(e.params[0])){const[{lifespan:t}]=e.params;n=t}const o=yield t(m["a"].createDIDTokenForUser(n));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:o}))}))));A.use("fm_auth_get_metadata",_["a"],(({payload:e,dispatch:t,getState:n})=>O(void 0,void 0,void 0,(function*(){var i,o;const a=(i=n().Auth.userKeys.publicAddress)!==null&&i!==void 0?i:null;const s=(o=n().Auth.userEmail)!==null&&o!==void 0?o:null;yield t(h["a"].resolveJsonRpcResponse({payload:e,result:{publicAddress:a,email:s}}))}))));A.use("fm_is_logged_in",(({payload:e,dispatch:t,getState:n})=>O(void 0,void 0,void 0,(function*(){const{jwt:i,rt:a}=Object(o["d"])(e);const s=yield Object(o["f"])({jwt:i,rt:a});const r=s&&!!n().Auth.ust;yield t(h["a"].resolveJsonRpcResponse({payload:e,result:r}))}))));A.use("fm_auth_logout",(({payload:e,dispatch:t,getState:n})=>O(void 0,void 0,void 0,(function*(){try{if(n().Auth.userID)yield t(b["a"].logout());yield t(h["a"].resolveJsonRpcResponse({payload:e,result:true}))}catch(t){yield a["q"].rpc.internalError().sdkReject(e)}}))));var S=n(41);var k=n(69);var D=n(222);var I=n(156);var x=n(386);var P=n(99);var q=n(149);var J=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const U=new v["b"];U.use(q["a"]);U.use("eth_gasPrice",(({payload:e,dispatch:t})=>J(void 0,void 0,void 0,(function*(){const n=yield S["a"].getGasPrice();yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}))));U.use("eth_sendTransaction",_["a"],(({payload:e,dispatch:t})=>J(void 0,void 0,void 0,(function*(){const n=yield t(m["a"].sendTransactionForUser(e));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}))));U.use("eth_accounts",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const i=yield D["a"].get("eth_accounts",(()=>J(void 0,void 0,void 0,(function*(){return n().Auth.userKeys.publicAddress}))));if(i)yield t(h["a"].resolveJsonRpcResponse({payload:e,result:[Object(k["b"])(i)]}));else yield a["q"].client.userDeniedAccountAccess().sdkReject(e)}))));U.use("eth_coinbase",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const i=yield D["a"].get("eth_coinbase",(()=>J(void 0,void 0,void 0,(function*(){return n().Auth.userKeys.publicAddress}))));if(i)yield t(h["a"].resolveJsonRpcResponse({payload:e,result:Object(k["b"])(i)}));else yield a["q"].client.userDeniedAccountAccess().sdkReject(e)}))));U.use("net_version",(({payload:e,dispatch:t})=>J(void 0,void 0,void 0,(function*(){const n=yield D["a"].get("net_version",(()=>J(void 0,void 0,void 0,(function*(){const t=yield I["a"].ethereumProxy(e);return t!==null&&t!==void 0?t:null}))));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}))));U.use("personal_sign",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[i,o]=e.params;if(!Object(k["a"])([o,n().Auth.userKeys.publicAddress])){yield a["q"].web3.userDeniedSigning().sdkReject(e)}else{const n=yield t(m["a"].personalSignForUser(i));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}}))));U.use("personal_ecRecover",(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[n,i]=e.params;const o=S["a"].recoverPersonalSignature(n,i);yield t(h["a"].resolveJsonRpcResponse({payload:e,result:Object(k["b"])(o)}))}))));U.use("eth_sign",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[i,o]=e.params;if(!Object(k["a"])([i,n().Auth.userKeys.publicAddress])){yield a["q"].web3.userDeniedSigning().sdkReject(e)}else{const n=yield t(m["a"].personalSignForUser(o));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}}))));U.use("eth_signTypedData",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[i,o]=e.params;if(!Object(k["a"])([o,n().Auth.userKeys.publicAddress])){yield a["q"].web3.userDeniedSigning().sdkReject(e)}else{const n=yield t(m["a"].signTypedDataV1ForUser(i));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}}))));U.use("eth_signTypedData_v3",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[o,s]=e.params;const r=Object(i["isString"])(s)?JSON.parse(s):s;if(!Object(k["a"])([o,n().Auth.userKeys.publicAddress])){yield a["q"].web3.userDeniedSigning().sdkReject(e)}else{const n=yield t(m["a"].signTypedDataV3ForUser(r));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}}))));U.use("eth_signTypedData_v4",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){const[o,s]=e.params;const r=Object(i["isString"])(s)?JSON.parse(s):s;if(!Object(k["a"])([o,n().Auth.userKeys.publicAddress])){yield a["q"].web3.userDeniedSigning().sdkReject(e)}else{const n=yield t(m["a"].signTypedDataV4ForUser(r));yield t(h["a"].resolveJsonRpcResponse({payload:e,result:n}))}}))));U.use("eth_signTransaction",_["a"],(({payload:e,dispatch:t,getState:n})=>J(void 0,void 0,void 0,(function*(){var i,o,a,s,r,c,d,u,l,v,p;const{Auth:f}=n();const y=yield S["a"].getChainId();const b={to:e.params[0].to,value:e.params[0].value,data:e.params[0].data,chainId:Object(P["hexToNumber"])(y)||1};const g=(yield x["a"].getTransactionFeeV2(e,(i=f.userKeys)===null||i===void 0?void 0:i.walletId)).data;const j=g.estimated_gas_limit;const w=(o=g===null||g===void 0?void 0:g.priority)===null||o===void 0?void 0:o.crypto_gas_price_in_hex;const _=(a=e.params[0])===null||a===void 0?void 0:a.data;const O=_&&_!=="0x"&&_!=="0x0"?91e3:21e3;const{maxPriorityFeePerGas:R,maxFeePerGas:A}=e.params[0];if(R){b.maxPriorityFeePerGas=R;b.maxFeePerGas=A}else{b.gasPrice=(c=(r=(s=e.params[0].gasPrice)!==null&&s!==void 0?s:w)!==null&&r!==void 0?r:yield S["a"].getGasPrice())!==null&&c!==void 0?c:undefined}b.gas=(l=(u=(d=e.params[0].gas)!==null&&d!==void 0?d:j)!==null&&u!==void 0?u:yield S["a"].estimateGas(b))!==null&&l!==void 0?l:O;b.nonce=(p=(v=e.params[0].nonce)!==null&&v!==void 0?v:yield S["a"].getTransactionCount(f.userKeys.publicAddress))!==null&&p!==void 0?p:undefined;const k=yield t(m["a"].signTransactionForUser(b));const D={raw:k.rawTransaction,tx:{nonce:b.nonce,gasPrice:b.gasPrice,gas:b.gas,to:b.to,value:b.value,v:k.v,r:k.r,s:k.s,hash:k.transactionHash}};yield t(h["a"].resolveJsonRpcResponse({payload:e,result:D}))}))));var F=n(119);var E=n(328);var T=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};function C(){return T(this,void 0,void 0,(function*(){const{ledgerBridge:e,ledgerMethodsMapping:t}=yield Object(E["a"])();const n=new v["b"];for(const[o,a]of Object(i["toPairs"])(t)){n.use(o,_["a"],(({payload:t,getState:n,dispatch:o})=>T(this,void 0,void 0,(function*(){if(Object(i["has"])(e,"init")){yield e.init()}const s=n().Auth.userKeys.encryptedPrivateAddress;const{delegatedWalletInfo:r}=n().Auth;const{systemClockOffset:c}=n().System;let d=yield F["a"].kmsDecrypt(s,r,c);const u=yield Object(i["get"])(e,a)(t,d);d=null;yield o(h["a"].resolveJsonRpcResponse({payload:t,result:u}))}))))}return n}))}var L=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};function K(e,t,n){return L(this,void 0,void 0,(function*(){try{if(n){yield n(e)}else if(Object(u["i"])()||t==="batch"){yield Object(o["a"])(e)}else{yield a["q"].rpc.methodNotFoundError(`\`${e===null||e===void 0?void 0:e.method}\``).sdkReject(e)}}catch(t){yield Object(a["j"])(e,t)}}))}function M(e){return L(this,void 0,void 0,(function*(){if(Array.isArray(e))return N(e);const t=Object(i["cloneDeep"])(e);if(yield d(t)){if(Object(s["b"])(t)){const n=Object(u["i"])()?U:yield C();const s=Object(i["keys"])(p["a"].features).find((e=>Object(i["keys"])(p["a"].features[e].rpc).includes(t.method)));let r;try{r=s?new v["b"]({[t.method]:(new v["a"]).loadConfig((yield Object(l["a"])(s,"RPC",p["a"].features[s].rpc[t.method])).default)}):undefined}catch(t){yield a["q"].rpc.internalError(t.message).sdkReject(e);return}const c=Object(o["c"])(t,Object(f["a"])([A,y["b"],n,r]));yield K(t,"single",c)}else if(Object(s["a"])(t)){yield N(t)}}}))}function N(e){return L(this,void 0,void 0,(function*(){const t=Object(i["isArray"])(e)?Object(i["cloneDeep"])(e):e.batch.map(i["cloneDeep"]);if(!Object(i["isEmpty"])(t)){const e=t.map((e=>{const t=Object(o["c"])(e,[U]);return()=>L(this,void 0,void 0,(function*(){if(yield d(e)){yield K(e,"batch",t)}}))}));e.map((e=>L(this,void 0,void 0,(function*(){yield e()}))))}else{yield a["q"].client.missingPayloadBatch().sdkReject(t)}}))}},37:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n.d(t,"b",(function(){return c}));var i=n(118);var o=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const a=(e,t)=>o(void 0,void 0,void 0,(function*(){const{payload:n,dispatch:o,render:a}=e;const[{showUI:s}]=n.params;if(s){yield o(i["a"].acquireLockAndShowUI(n,a))}t()}));const s=(e,t)=>o(void 0,void 0,void 0,(function*(){const{payload:n,dispatch:o,render:a}=e;yield o(i["a"].acquireLockAndShowUI(n,a));t()}));const r=Object.assign(a,{force:s});const c=e=>{const[{showUI:t}]=e.params;return t}},38:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(14);var o=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const a=({payload:e},t)=>o(void 0,void 0,void 0,(function*(){const{jwt:n,rt:o}=Object(i["d"])(e);yield Object(i["g"])({jwt:n,rt:o});t()}))},44:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(14);var o=n(173);var a=undefined&&undefined.__awaiter||function(e,t,n,i){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function s(e){try{c(i.next(e))}catch(e){a(e)}}function r(e){try{c(i["throw"](e))}catch(e){a(e)}}function c(e){e.done?n(e.value):o(e.value).then(s,r)}c((i=i.apply(e,t||[])).next())}))};const s=(e=(()=>true))=>(t,n)=>a(void 0,void 0,void 0,(function*(){const{payload:a}=t;const s=Object(i["d"])(a);const r=e(a);if(!r){n();return}if(!s.didAcquireAtomicSemaphorePermit){yield o["a"].acquire();Object(i["e"])(a).once("done",(()=>{o["a"].signal()}));s.didAcquireAtomicSemaphorePermit=true}n()}))}}]);