(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[42],{2105:function(e,t,r){r(720);e.exports=r(719)},395:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var a=r(7);var n=r(326);var o=r(22);function i(e,t,r,i){const c=`/v2/oauth/user/verify`;const s={magic_oauth_request_id:e,magic_verifier:t};return o["a"].magic.post(c,s,{headers:Object.assign(Object.assign({},Object(a["pickBy"])({authorization:r&&`Bearer ${r}`})),Object(n["a"])(i))})}var c=r(171);var s=r.n(c);function u(e,t){const r=`/v1/oauth2/user/info/retrieve?${s.a.stringify({provider:e,field_format:"camelCase"})}`;return o["a"].authRelayer.get(r,{headers:Object(a["pickBy"])({authorization:`Bearer ${t}`})})}function d(e){const t=`/v1/oauth2/credential/send?${e}`;return o["a"].authRelayer.get(t)}function l(e){const t=`/v1/oauth2/error/send?${e}`;return o["a"].authRelayer.get(t)}const v={getAccessToken:i,getUserInfo:u,sendCredential:d,sendError:l}},719:function(e,t,r){"use strict";r.r(t);var a=r(0);var n=r.n(a);var o=r(763);var i=r(10);var c=r(28);var s=r(172);var u=r(26);var d=r(23);var l=r(21);var v=r(464);var f=r(151);var h=r(16);var y=r(197);var b=r(95);var p=r(110);const j=e=>{const t=Object(s["a"])()._lfc;const{isLoading:r,error:a,mfaVerifyCodes:o}=Object(p["b"])(t);const{routes:i,createPageResolver:c}=Object(h["a"])([{id:"enforce-oauth-mfa",content:n.a.createElement(y["b"],{flowContext:t,onMfaComplete:e})},{id:"enter-recovery-code",content:n.a.createElement(b["a"],{tryRecovery:o,isLoading:r,error:a,navBackRoute:"enforce-oauth-mfa",onRecoverySuccess:e})},{id:"lost-recovery-code",content:n.a.createElement(b["c"],{navBackRoute:"enter-recovery-code"})},{id:"recovery-code-lockout",content:n.a.createElement(b["b"],{hideActions:true})}]);const u=c((()=>"enforce-oauth-mfa"));return{routes:i,resolver:u}};var O=r(171);var m=r.n(O);var g=r(2056);var _=r(35);var w=r(301);var k=undefined&&undefined.__awaiter||function(e,t,r,a){function n(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a["throw"](e))}catch(e){o(e)}}function s(e){e.done?r(e.value):n(e.value).then(i,c)}s((a=a.apply(e,t||[])).next())}))};const E=()=>{const[e,t]=Object(a["useState"])(false);Object(g["a"])((()=>k(void 0,void 0,void 0,(function*(){if(!Object(s["a"])()._oaclientmeta&&!(yield w["a"].data.getItem("isMissingOAuthClientMeta"))){yield w["a"].data.setItem("isMissingOAuthClientMeta",true);return true}yield w["a"].data.removeItem("isMissingOAuthClientMeta");return false}))),[]).fullfilled((e=>{if(e){window.location.reload()}else{t(!e)}}));return{isSafariHackDone:e}};var M=r(45);var C=r(48);var P=r(6);var A=r(395);var R=undefined&&undefined.__awaiter||function(e,t,r,a){function n(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a["throw"](e))}catch(e){o(e)}}function s(e){e.done?r(e.value):n(e.value).then(i,c)}s((a=a.apply(e,t||[])).next())}))};const S=({isMfaEnabled:e,isMfaComplete:t})=>{const{isSafariHackDone:r}=E();const n=Object(_["a"])();const[o,i]=Object(a["useState"])("");Object(g["a"])((()=>R(void 0,void 0,void 0,(function*(){if(!r){return}if(e&&!t){return}try{let t;if(e){t=yield n(C["a"].hydrateActiveUser())}else{t=yield n(C["a"].hydrateActiveUser({from:"cookies"}))}if(t){const e=yield n(M["a"].createOAuthMagicCredentialForUser());if(e){return Object.assign(Object.assign({},(yield A["a"].sendCredential(m.a.stringify({magic_credential:e}))).data),{isError:false})}}throw Object(P["d"])()}catch(e){const t=m.a.stringify(e);try{return Object.assign(Object.assign({},(yield A["a"].sendError(t)).data),{isError:true})}catch(e){throw t}}}))),[r,e,t]).rejected((e=>{i(e)})).fullfilled((e=>{if(e){if(e.isError&&e.platform==="rn"){i(e.query)}else{window.location.href=e.redirectURI}}}));return{errorRedirectQuery:o}};var U=r(34);const B=()=>{const[e,t]=Object(a["useState"])(false);const r=Object(s["a"])()._lfc&&Object(s["a"])()._mfafr;const{errorRedirectQuery:u}=S({isMfaComplete:e,isMfaEnabled:r});const d=j((({auth_user_id:e,auth_user_session_token:r,refresh_token:a})=>{i["b"].dispatch(Object(c["j"])(e));i["b"].dispatch(Object(c["h"])(r));i["b"].dispatch(Object(c["g"])(a));t(true)}));const{page:y}=Object(h["a"])([...d.routes]);return n.a.createElement(f["a"],null,u&&n.a.createElement(o["a"],{to:`${l["a"].Client.ErrorV1}?${u}`}),r?n.a.createElement(U["a"],{in:true},n.a.createElement("div",{id:"modal-portal"},y)):n.a.createElement(v["a"],null))};var Q=t["default"]=d["a"].Page({render:()=>n.a.createElement(B,null),parseApiKey:()=>{var e,t;return(t=(e=Object(s["a"])()._oaclientmeta)===null||e===void 0?void 0:e.magic_api_key)!==null&&t!==void 0?t:""},parseLocale:()=>Object(u["d"])().locale,parseTheme:()=>Object(s["a"])()._ct})},720:function(e,t,r){"use strict";r.r(t);var a=r(149);var n=r(23);var o=r(7);var i=r(14);var c=r(26);var s=r(395);var u=r(6);function d(e){if(!e)return"";if(Object(o["isString"])(e)){return Object(o["uniq"])(v(e)).join(" ")}return Object(o["chain"])(e).map(o["toString"]).map(o["trim"]).uniq().filter(Boolean).value()}function l(e=[]){return Object(o["chain"])(e).map(o["toString"]).map(o["trim"]).uniq().filter(Boolean).join(" ").value()}function v(e){var t;return(t=Object(o["chain"])(e===null||e===void 0?void 0:e.split(/\s+/)).map(o["trim"]).uniq().filter(Boolean).value())!==null&&t!==void 0?t:[]}var f=r(28);var h=r(45);var y=r(48);var b=r(376);var p=undefined&&undefined.__awaiter||function(e,t,r,a){function n(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a["throw"](e))}catch(e){o(e)}}function s(e){e.done?r(e.value):n(e.value).then(i,c)}s((a=a.apply(e,t||[])).next())}))};const j=(e,t)=>p(void 0,void 0,void 0,(function*(){yield _(e,(()=>p(void 0,void 0,void 0,(function*(){const{payload:t}=e;const[r,a,n]=t.params;e.oauthParsedQuery=Object(c["d"])(r.substr(1));e.oauthMagicVerifier=a;e.oauthOriginalState=n;if(e.oauthParsedQuery.error){return Object(i["i"])(t,e.oauthParsedQuery)}}))));t()}));const O=(e,t)=>p(void 0,void 0,void 0,(function*(){const{payload:r,oauthParsedQuery:a,oauthOriginalState:n}=e;if(n!==(a===null||a===void 0?void 0:a.state)){return Object(i["i"])(r,Object.assign(Object.assign({},Object(u["g"])()),{provider:a===null||a===void 0?void 0:a.provider}))}t()}));const m=(e,t)=>p(void 0,void 0,void 0,(function*(){yield _(e,(()=>p(void 0,void 0,void 0,(function*(){const{dispatch:t,oauthParsedQuery:r,oauthMagicVerifier:a,payload:n}=e;const{jwt:o}=Object(i["d"])(n);const{auth_user_id:c,auth_user_session_token:u,access_token:d,provider_user_handle:l,refresh_token:v}=(yield s["a"].getAccessToken(r===null||r===void 0?void 0:r.magic_oauth_request_id,a,r===null||r===void 0?void 0:r.magic_credential,o)).data;if(v){t(Object(f["g"])(v))}t(Object(f["j"])(c));t(Object(f["h"])(u));yield Object(i["g"])();e.oauthAccessToken=d;e.oauthUserHandle=l}))));t()}));const g=e=>p(void 0,void 0,void 0,(function*(){yield _(e,(()=>p(void 0,void 0,void 0,(function*(){var t;const{payload:r,dispatch:a,oauthParsedQuery:n,oauthAccessToken:o,oauthUserHandle:c}=e;const u=15*60;const d=yield a(h["a"].createDIDTokenForUser(u));const l=(n===null||n===void 0?void 0:n.provider)==="apple"?d:o;const y=(yield s["a"].getUserInfo(n===null||n===void 0?void 0:n.provider,l)).data;const p=(t=y.emailVerified)!==null&&t!==void 0?t:true;a(Object(f["i"])(p&&y.email||null));const j=yield a(b["a"].formatMagicUserMetadata());return Object(i["i"])(r,{oauth:{provider:n===null||n===void 0?void 0:n.provider,scope:v(n===null||n===void 0?void 0:n.scope),accessToken:o,userHandle:c,userInfo:y},magic:{idToken:d,userMetadata:j}})}))))}));function _(e,t){var r;return p(this,void 0,void 0,(function*(){try{yield t()}catch(t){yield e.dispatch(y["a"].logout()).catch(o["noop"]);return Object(i["i"])(e.payload,Object.assign(Object.assign({},Object(u["b"])()),{provider:(r=e.oauthParsedQuery)===null||r===void 0?void 0:r.provider}))}}))}var w=t["default"]=n["a"].RPC({middlewares:[a["b"],j,O,m,g]})}}]);